<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <!-- This is broken by doc revisioning.
         -->
        <link rel="shortcut icon" href="../../../img/favicon.ico">

        <title>BLE iBeacon - Apache Mynewt</title>

        <link href="../../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/base.css" rel="stylesheet">
        <link href="../../../css/custom.css" rel="stylesheet">
        <link href="../../../css/v2.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    </head>


    <body class="BLE iBeacon">

        <div id="wrapper">
            <div class="container">
    <div class="row v2-main-banner">
        <a class="logo-cell" href="/">
            <img class="logo" src="/img/logo.png">
        </a>
        <div class="tagline-cell">
            <h4 class="tagline">An OS to build, deploy and securely manage billions of devices</h4>
        </div>
        <div class="news-cell">
            <div class="well">
                <h4>Latest News:</h4> <a href="/download">Apache Mynewt 1.13.0, Apache NimBLE 1.8.0 </a> released (November 25, 2024)
            </div>
        </div>
    </div>
</div>

            






<nav id="navbar" class="navbar navbar-inverse affix-top" data-spy="affix" data-offset-top="150" role="navigation">
    <div class="container">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav navbar-right">
                <li 
  class=""
>
                    <a href="/" style="font-size: larger;">&#127968;</a>
                </li>
                <li 
  class="important"
>
                    <a href="/quick-start/">Quick Start</a>
                </li>
                <li 
  class=""
>
                    <a href="/about/">About</a>
                </li>
                <li 
  class=""
>
                    <a href="/talks/">Talks</a>
                </li>
                <li 
  class="active  "
>
                    <a href="/documentation/">Documentation</a>
                </li>
                <li 
  class=""
>
                    <a href="/download/">Download</a>
                </li>
                <li 
  class=""
>
                    <a href="/community/">Community</a>
                </li>
                <li 
  class=""
>
                    <a href="/cve/">CVE</a>
                </li>
            </ul>

        </div>
    </div>
</nav>

            
            <div id="main-content">
                <div class="container">
                    
                        <div class="row">
                            <div class="col-md-3 v2-sidebar sidebar-container"><div id="docSidebar" class="hidden-print" role="complementary">
    <div class="top">
        <div role="search">
            <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
                <div class="form-group">
                    <input type="text" name="q" class="form-control" placeholder="Search documentation" />
                </div>
            </form>
        </div>
    </div>
    <ul class="toc-nav">
      <li class="doc-version"><select class="form-control" onchange="if (this.value) window.location.href=this.value">
  <option value="/latest">
    Version: latest
  </option>

  <option value="/master/" >
    Version: master
  </option>
  <option value="/v1_13_0/" >
    Version: 1.13.0
  </option>
  <option value="/v1_12_0/" >
    Version: 1.12.0
  </option>
  <option value="/v1_11_0/" >
    Version: 1.11.0
  </option>
  <option value="/v1_10_0/" >
    Version: 1.10.0
  </option>
  <option value="/v1_9_0/" >
    Version: 1.9.0
  </option>
    <option value="/v1_8_0/" >
    Version: 1.8.0
  </option>
  <option value="/v1_7_0/" >
    Version: 1.7.0
  </option>
  <option value="/v1_6_0/" >
    Version: 1.6.0
  </option>
  <option value="/v1_5_0/" >
    Version: 1.5.0
  </option>
  <option value="/v1_4_0/" >
    Version: 1.4.0
  </option>
  <option value="/v1_3_0/os/introduction" >
    Version: 1.3.0
  </option>
  <option value="/v1_2_0/os/introduction" >
    Version: 1.2.0
  </option>
  <option value="/v1_1_0/os/introduction" >
    Version: 1.1.0
  </option>
  <option value="/v1_0_0/os/introduction" >
    Version: 1.0.0
  </option>
  <option value="/v0_9_0/os/introduction" selected="selected" >
    Version: 0.9.0
  </option>
</select></li>
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
  
  
    <li ><a href="../../introduction/">Mynewt Documentation</a>
  
  
    <ul>
          
              
          
              
                
  
  
    <li ><a href="../../get_started/get_started/">Basic Setup</a>
  
  
    </li>

              
          
              
                
  <li >
    <a href="../../get_started/vocabulary/">Concepts</a>
  </li>

              
          
              
                
  
  
    <li ><a href="../tutorials/">Tutorials</a>
  
  
    <ul>
          
              
          
              
                
  
  
    <li><a href="
  ../arduino_zero/
">Project Blinky</a>
  
  
    </li>

              
          
              
                
  
  
    <li ><a href="../repo/add_repos/">Work with repositories</a>
  
  
    </li>

              
          
              
                
  <li >
    <a href="../unit_test/">Write a Test Suite for a Package</a>
  </li>

              
          
              
                
  <li >
    <a href="../air_quality_sensor/">Air-quality Sensor project</a>
  </li>

              
          
              
                
  <li >
    <a href="../event_queue/">Add task to manage multiple events</a>
  </li>

              
          
              
                
  <li >
    <a href="../project-slinky/">Enable remote comms on sim device</a>
  </li>

              
          
              
                
  <li >
    <a href="../project-target-slinky/">Enable remote comms on STM32 board</a>
  </li>

              
          
              
                
  <li >
    <a href="../bletiny_project/">BLE app to check stats via console</a>
  </li>

              
          
              
                
  
  
    <li ><a href="../bleprph/bleprph-intro/">BLE peripheral project</a>
  
  
    </li>

              
          
              
                
  <li class="active">
    <a href="./">BLE iBeacon</a>
  </li>

              
          
              
                
  <li >
    <a href="../blehci_project/">BLE HCI interface</a>
  </li>

              
          
    </ul>
  
    </li>

              
          
              
                
  
  
    <li ><a href="../../os_user_guide/">OS User Guide</a>
  
  
    </li>

              
          
              
                
  
  
    <li><a href="
  ../../../network/ble/ble_intro/
">BLE User Guide</a>
  
  
    </li>

              
          
              
                
  
  
    <li ><a href="../../../newt/newt_intro/">Newt Tool Guide</a>
  
  
    </li>

              
          
              
                
  
  
    <li ><a href="../../../newtmgr/overview/">Newt Manager Guide</a>
  
  
    </li>

              
          
              
                
  <li >
    <a href="../../../known_issues/">Known Issues</a>
  </li>

              
          
    </ul>
  
    </li>

        
      
        
          
  
  
    <li><a href="
  ../../../faq/how_to_edit_docs/
">Appendix</a>
  
  
    </li>

        
      
    </ul>
</div></div>

                            <div class="col-md-9" role="main">
                                <div class="doc-header">
                                    <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="/documentation/">Docs</a></li>
    
    
        
          <li>&raquo; <a href="os/tutorials/tutorials/">Tutorials</a></li>
        
      
        
          <li>&raquo; <a href="os/introduction/">Mynewt Documentation</a></li>
        
      
      
        <li>&raquo; BLE iBeacon</li>
      
    
    
  </ul>
</div>
                                </div>
                                
                                  
                                
                                  
                                    <div class="alert alert-warning">
                                        <p>
                                            Version 0.9.0 is not the most recent version of the Apache Mynewt
                                            documentation. Click <a href="/latest">here</a> to read the latest
                                            version.
                                        </p>
                                    </div>
                                  
                                
                                  
                                
                                
                                    <h2 id="ble-ibeacon">BLE iBeacon</h2>
<p><br></p>
<h3 id="ibeacon-protocol">iBeacon Protocol</h3>
<p>A beaconing device announces its presence to the world by broadcasting
advertisements.  The iBeacon protocol is built on top of the standard BLE
advertisement specification.  An iBeacon advertisement contains a single field:
<em>Manufacturer Specific Data</em>; this field contains the iBeacon-specific
sub-fields.  <a href="http://www.warski.org/blog/2014/01/how-ibeacons-work/">This page</a>
provides a good summary of the iBeacon sub-fields.</p>
<p><br></p>
<h3 id="configuration">Configuration</h3>
<p>Use the following function to configure your NimBLE device to send iBeacons:</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #A90D91">int</span>
<span style="color: #000">ble_ibeacon_set_adv_data</span>(<span style="color: #A90D91">void</span> <span style="color: #000">*uuid128</span>, <span style="color: #A90D91">uint16_t</span> <span style="color: #000">major</span>, <span style="color: #A90D91">uint16_t</span> <span style="color: #000">minor</span>)
</code></pre></div>

<p>This function's parameters are documented below.</p>
<table>
<thead>
<tr>
<th><em>Parameter</em></th>
<th><em>Purpose</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>UUID</td>
<td>128-bit UUID identifying the application</td>
</tr>
<tr>
<td>Major version number</td>
<td>First number in your app's version</td>
</tr>
<tr>
<td>Minor version number</td>
<td>Second number in your app's version</td>
</tr>
</tbody>
</table>
<p><br></p>
<h3 id="modify-bleprph">Modify bleprph</h3>
<p>To demonstrate how the above function is used, we will now modify the <em>bleprph</em>
example application to send iBeacons.  For some background behind the <em>bleprph</em>
app, we recommend you take a look at the <a href="bleprph/bleprph_intro/">bleprph project
tutorial</a>.  If you plan on making these modifications
yourself, it might be a good idea to copy <em>bleprph</em> to your local repository
and work with the copy.  In general, you should avoid changing a package that
newt downloads, as you will lose your changes the next time you upgrade the
package.</p>
<p><em>bleprph</em> sets its advertisement data and begins advertising as follows (<em>main.c</em>):</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #A90D91">static</span> <span style="color: #A90D91">void</span>
<span style="color: #000">bleprph_advertise</span>(<span style="color: #A90D91">void</span>)
{
    <span style="color: #A90D91">struct</span> <span style="color: #3F6E75">ble_hs_adv_fields</span> <span style="color: #000">fields</span>;
    <span style="color: #A90D91">int</span> <span style="color: #000">rc</span>;

    <span style="color: #177500">/* Set the advertisement data included in our advertisements. */</span>
    <span style="color: #000">memset</span>(<span style="color: #000">&amp;fields</span>, <span style="color: #1C01CE">0</span>, <span style="color: #A90D91">sizeof</span> <span style="color: #000">fields</span>);
    <span style="color: #000">fields</span>.<span style="color: #000">name</span> <span style="color: #000">=</span> (<span style="color: #A90D91">uint8_t</span> <span style="color: #000">*</span>)<span style="color: #000">bleprph_device_name</span>;
    <span style="color: #000">fields</span>.<span style="color: #000">name_len</span> <span style="color: #000">=</span> <span style="color: #000">strlen</span>(<span style="color: #000">bleprph_device_name</span>);
    <span style="color: #000">fields</span>.<span style="color: #000">name_is_complete</span> <span style="color: #000">=</span> <span style="color: #1C01CE">1</span>;
    <span style="color: #000">rc</span> <span style="color: #000">=</span> <span style="color: #000">ble_gap_adv_set_fields</span>(<span style="color: #000">&amp;fields</span>);
    <span style="color: #A90D91">if</span> (<span style="color: #000">rc</span> <span style="color: #000">!=</span> <span style="color: #1C01CE">0</span>) {
        <span style="color: #000">BLEPRPH_LOG</span>(<span style="color: #000">ERROR</span>, <span style="color: #C41A16">&quot;error setting advertisement data; rc=%d\n&quot;</span>, <span style="color: #000">rc</span>);
        <span style="color: #A90D91">return</span>;
    }

    <span style="color: #177500">/* Begin advertising. */</span>
    <span style="color: #000">rc</span> <span style="color: #000">=</span> <span style="color: #000">ble_gap_adv_start</span>(<span style="color: #000">BLE_GAP_DISC_MODE_GEN</span>, <span style="color: #000">BLE_GAP_CONN_MODE_UND</span>,
                           <span style="color: #A90D91">NULL</span>, <span style="color: #1C01CE">0</span>, <span style="color: #A90D91">NULL</span>, <span style="color: #000">bleprph_on_connect</span>, <span style="color: #A90D91">NULL</span>);
    <span style="color: #A90D91">if</span> (<span style="color: #000">rc</span> <span style="color: #000">!=</span> <span style="color: #1C01CE">0</span>) {
        <span style="color: #000">BLEPRPH_LOG</span>(<span style="color: #000">ERROR</span>, <span style="color: #C41A16">&quot;error enabling advertisement; rc=%d\n&quot;</span>, <span style="color: #000">rc</span>);
        <span style="color: #A90D91">return</span>;
    }
}
</code></pre></div>

<p>The call to <code>ble_gap_adv_set_fields()</code> configures the device with normal
(non-iBeacon) advertisements; the call to <code>ble_gap_adv_start()</code> tells the
NimBLE stack to start broadcasting.  We are now going to create an iBeacon app
by making the following to changes:</p>
<ul>
<li>Call <code>ble_ibeacon_set_adv_data()</code> instead of <code>ble_gap_adv_set_fields()</code>.</li>
<li>Modify the call to <code>ble_gap_adv_start()</code> such that the device is non-discoverable and non-connectable.</li>
</ul>
<p><br></p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #A90D91">static</span> <span style="color: #A90D91">void</span>
<span style="color: #000">bleprph_advertise</span>(<span style="color: #A90D91">void</span>)
{
<span style="background-color: #ffffcc">    <span style="color: #A90D91">uint8_t</span> <span style="color: #000">uuid128</span>[<span style="color: #1C01CE">16</span>];
</span>    <span style="color: #A90D91">int</span> <span style="color: #000">rc</span>;

<span style="background-color: #ffffcc">    <span style="color: #177500">/* Arbitrarily et the UUID to a string of 0x11 bytes. */</span>
</span><span style="background-color: #ffffcc">    <span style="color: #000">memset</span>(<span style="color: #000">uuid128</span>, <span style="color: #1C01CE">0x11</span>, <span style="color: #A90D91">sizeof</span> <span style="color: #000">uuid128</span>);
</span>
<span style="background-color: #ffffcc">    <span style="color: #177500">/* Major version=2; minor version=10. */</span>
</span><span style="background-color: #ffffcc">    <span style="color: #000">rc</span> <span style="color: #000">=</span> <span style="color: #000">ble_ibeacon_set_adv_data</span>(<span style="color: #000">uuid128</span>, <span style="color: #1C01CE">2</span>, <span style="color: #1C01CE">10</span>);
</span>    <span style="color: #A90D91">if</span> (<span style="color: #000">rc</span> <span style="color: #000">!=</span> <span style="color: #1C01CE">0</span>) {
        <span style="color: #000">BLEPRPH_LOG</span>(<span style="color: #000">ERROR</span>, <span style="color: #C41A16">&quot;error setting iBeacon advertisement data; rc=%d\n&quot;</span>,
                    <span style="color: #000">rc</span>);
        <span style="color: #A90D91">return</span>;
    }

    <span style="color: #177500">/* Begin advertising. */</span>
<span style="background-color: #ffffcc">    <span style="color: #000">rc</span> <span style="color: #000">=</span> <span style="color: #000">ble_gap_adv_start</span>(<span style="color: #000">BLE_GAP_DISC_MODE_NON</span>, <span style="color: #000">BLE_GAP_CONN_MODE_NON</span>,
</span>                           <span style="color: #A90D91">NULL</span>, <span style="color: #1C01CE">0</span>, <span style="color: #A90D91">NULL</span>, <span style="color: #000">bleprph_on_connect</span>, <span style="color: #A90D91">NULL</span>);
    <span style="color: #A90D91">if</span> (<span style="color: #000">rc</span> <span style="color: #000">!=</span> <span style="color: #1C01CE">0</span>) {
        <span style="color: #000">BLEPRPH_LOG</span>(<span style="color: #000">ERROR</span>, <span style="color: #C41A16">&quot;error enabling advertisement; rc=%d\n&quot;</span>, <span style="color: #000">rc</span>);
        <span style="color: #A90D91">return</span>;
    }
}
</code></pre></div>

<p>Now when you run this app on your board, you should be able to see it with all
your iBeacon-aware devices.</p>
                                
                                <div class="row">
                                    



<ul class="nav nav-pills" style="margin-bottom: 10px">
    <li>
    
    </li>
    <li class="pull-right">
    
    </li>
</ul>
                                </div>
                            </div>
                        </div>
                    
                </div>
            </div>
            <footer>
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                
                    <p class="copyright">Apache Mynewt (incubating) is available under Apache License, version 2.0.</p>
                
            </div>
        <div class="col-xs-12">
                <div class="logos">
                    <a href="https://www.apache.org/">
                        <img src="/img/asf_logo_wide_small.png" alt="Apache" title="Apache">
                    </a>
                    <p>
                        Copyright Â© 2015-2024 The Apache Software Foundation.<br>
                        <small class="footnote">
                            Apache Mynewt, Mynewt, Apache, the Apache feather logo, and the Apache Mynewt
                            project logo are either registered trademarks or trademarks of the Apache
                            Software Foundation in the United States and other countries.
                        </small>
                    </p>
                    <a href="">
                        <img src="/img/add_to_slack.png" alt="Slack Icon" title="Join our Slack Community" />
                    </a>
                </div>
            </div>
        </div>
    </div>
    <a href="https://www.apache.org/licenses/">
        <button class="button-footer-asf">
            License
        </button>
    </a>
    <a href="https://www.apache.org/foundation/sponsorship.html">
        <button class="button-footer-asf">
            Sponsorship
        </button>
    </a>
    <a href="https://www.apache.org/foundation/thanks.html">
        <button class="button-footer-asf">
            Thanks
        </button>
    </a>
    <a href="https://www.apache.org/security/">
        <button class="button-footer-asf">
            Security
        </button>
    </a>
    <a href="https://apache.org/events/current-event">
        <button class="button-footer-asf">
            ASF Events
        </button>
    </a>
</footer>
        </div>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script src="../../../js/base.js"></script>
        <script src="../../../js/custom.js"></script>
            <script src="search/main.js"></script>

    </body>
</html>
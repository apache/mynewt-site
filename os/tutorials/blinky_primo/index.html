<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <!-- This is broken by doc revisioning.
        <link rel="canonical" href="http://mynewt.apache.org/os/tutorials/blinky_primo/"> -->
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	    <title>Blinky on Arduino Primo - Apache Mynewt</title>

        <link href="../../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/base.css" rel="stylesheet">
        <link href="../../../css/custom.css" rel="stylesheet">
        <link href="../../../css/v2.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link href="../../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-72162311-1', 'auto');
                ga('send', 'pageview');
            </script>
        
    </head>


    <body class="Blinky on Arduino Primo">


        <div class="container">
    <div class="row v2-main-banner">
        <a class="logo-cell" href="/">
            <img class="logo" src="/img/logo.png">
        </a>
        <div class="tagline-cell">
            <h4 class="tagline">An OS to build, deploy and securely manage billions of devices</h4>
        </div>
        <div class="news-cell">
            <div class="well">
                <h4>Latest News:</h4> <a href="/download">Apache Mynewt 1.0.0-b2</a> released (Feb 15, 2017)
            </div>
        </div>
    </div>
</div>

        






<nav id="navbar" class="navbar navbar-inverse affix-top" data-spy="affix" data-offset-top="150" role="navigation">
    <div class="container">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav navbar-right">
                <li 
  class=""
>
                    <a href="/"><i class="fa fa-home" style="font-size: larger;"></i></a>
                </li>
                <li 
  class="important"
>
                    <a href="/quick-start/">Quick Start</a>
                </li>
                <li 
  class=""
>
                    <a href="/about/">About</a>
                </li>
                <li 
  class=""
>
                    <a href="/talks/">Talks</a>
                </li>
                <li 
  class="active"
>
                    <a href="/latest/os/introduction">Documentation</a>
                </li>
                <li 
  class=""
>
                    <a href="/download/">Download</a>
                </li>
                <li 
  class=""
>
                    <a href="/community/">Community</a>
                </li>
                <li 
  class=""
>
                    <a href="/events/">Events</a>
                </li>
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
            </ul>
        </div>
    </div>
</nav>

        

        <div class="container">
            
                <div class="row">
                    <div class="col-md-3 v2-sidebar sidebar-container"><div id="docSidebar" class="hidden-print" role="complementary">
    <div class="top">
        <div role="search">
            <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
                <div class="form-group">
                    <input type="text" name="q" class="form-control" placeholder="Search documentation" />
                </div>
            </form>
        </div>
    </div>
    <ul class="toc-nav">
      <li class="doc-version">
<select class="form-control" onchange="if (this.value) window.location.href=this.value">
    
    <option
      value="/develop/os/introduction"
      selected="selected"
    >
      Version: develop (latest)
    </option>
    
    <option
      value="/v0_9_0/os/introduction"
      
    >
      Version: 0.9.0
    </option>
    
</select>
</li>
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
  
  
    <li ><a href="../../introduction/">Mynewt Documentation</a>
  
  
    <ul>
          
              
          
              
                
  
  
    <li ><a href="../../get_started/get_started/">Basic Setup</a>
  
  
    </li>

              
          
              
                
    <li >
      <a href="../../get_started/vocabulary/">Concepts</a>
    </li>

              
          
              
                
  
  
    <li ><a href="../tutorials/">Tutorials</a>
  
  
    <ul>
          
              
          
              
                
  
  
    <li><a href="
  ../arduino_zero/
">Project Blinky</a>
  
  
    <ul>
          
              
                
    <li >
      <a href="../arduino_zero/">Blinky on Arduino Zero</a>
    </li>

              
          
              
                
    <li class="active">
      <a href="./">Blinky on Arduino Primo</a>
    </li>

              
          
              
                
    <li >
      <a href="../olimex/">Blinky on Olimex</a>
    </li>

              
          
              
                
  
  
    <li ><a href="../STM32F303/">Blinky on STM32F303</a>
  
  
    </li>

              
          
              
                
    <li >
      <a href="../nRF52/">Blinky on nRF52</a>
    </li>

              
          
              
                
    <li >
      <a href="../blinky_sram_olimex/">Run Blinky from SRAM, no bootloader</a>
    </li>

              
          
    </ul>
  
    </li>

              
          
              
                
  
  
    <li ><a href="../repo/add_repos/">Work with repositories</a>
  
  
    </li>

              
          
              
                
    <li >
      <a href="../unit_test/">Write a Test Suite for a Package</a>
    </li>

              
          
              
                
    <li >
      <a href="../air_quality_sensor/">Air-quality Sensor project</a>
    </li>

              
          
              
                
    <li >
      <a href="../event_queue/">Add task to manage multiple events</a>
    </li>

              
          
              
                
    <li >
      <a href="../project-slinky/">Enable remote comms on sim device</a>
    </li>

              
          
              
                
    <li >
      <a href="../project-target-slinky/">Enable remote comms on STM32 board</a>
    </li>

              
          
              
                
    <li >
      <a href="../bletiny_project/">BLE app to check stats via console</a>
    </li>

              
          
              
                
  
  
    <li ><a href="../bleprph/bleprph-intro/">BLE peripheral project</a>
  
  
    </li>

              
          
              
                
    <li >
      <a href="../ibeacon/">BLE iBeacon</a>
    </li>

              
          
              
                
    <li >
      <a href="../blehci_project/">BLE HCI interface</a>
    </li>

              
          
    </ul>
  
    </li>

              
          
              
                
  
  
    <li ><a href="../../os_user_guide/">OS User Guide</a>
  
  
    </li>

              
          
              
                
  
  
    <li><a href="
  ../../../network/ble/ble_intro/
">BLE User Guide</a>
  
  
    </li>

              
          
              
                
  
  
    <li ><a href="../../../newt/newt_intro/">Newt Tool Guide</a>
  
  
    </li>

              
          
              
                
  
  
    <li ><a href="../../../newtmgr/overview/">Newt Manager Guide</a>
  
  
    </li>

              
          
    </ul>
  
    </li>

        
      
        
          
  
  
    <li><a href="
  ../../../faq/how_to_edit_docs/
">Appendix</a>
  
  
    </li>

        
      
    </ul>
</div></div>

                    <div class="col-md-9" role="main">
                        <div class="doc-header">
                            <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs pull-right">
    <li><a href="/develop/os/introduction">Docs</a></li>
    
    
        
          <li>&raquo; <a href="../tutorials/">Tutorials</a></li>
        
      
        
          <li>&raquo; <a href="../arduino_zero/">Project Blinky</a></li>
        
      
      
        <li>&raquo; Blinky on Arduino Primo</li>
      
    
    
  </ul>
</div>
                        </div>
                        
                            <h2 id="blinky-your-hello-world-on-arduino-primo">Blinky, your "Hello World!", on Arduino Primo</h2>
<p><br></p>
<h3 id="objective">Objective</h3>
<p>Learn how to use packages from a default application repository of Mynewt to build your first <em>Hello World</em> application (Blinky) on a target board. Once built using the <em>newt</em> tool, this application will blink the LED lights on the target board.</p>
<p>Create a project with a simple app that blinks an LED on the Arduino Primo board.  Download the application to the target and watch it blink!</p>
<p>Note that the Mynewt OS will run on the nRF52 chip in the Arduino Primo board. However, the board support package for the Arduino Primo is different from the nRF52 dev kit board support package.</p>
<p><br></p>
<h3 id="hardware-and-software-needed">Hardware and Software needed</h3>
<ul>
<li>Arduino Primo</li>
<li>Laptop running Mac OS</li>
<li>A micro USB 2.0 cable to power the Arduino primo board</li>
<li>It is assumed you have already installed newt tool. </li>
<li>It is assumed you already installed native tools as described <a href="../../get_started/native_tools/">here</a></li>
<li>Debugger - choose one of the two options below. Option 1 requires additional hardware but very easy to set up. Option 2 is free software install but not as simple as Option 1.</li>
</ul>
<p><br></p>
<h5 id="option-1">Option 1</h5>
<ul>
<li><a href="https://www.segger.com/jlink-debug-probes.html">Segger J-Link Debug Probe</a> - any model (this tutorial has been tested with J-Link EDU and J-Link Pro)</li>
<li><a href="https://www.segger.com/jlink-adapters.html#CM_9pin">J-Link 9 pin Cortex-M Adapter</a> that allows JTAG, SWD and SWO connections between J-Link and Cortex M based target hardware systems</li>
</ul>
<h5 id="option-2">Option 2</h5>
<ul>
<li>No additional hardware is required but a version of OpenOCD 0.10.0 that is currently in development needs to be installed. A patch for the nRF52 has been applied to the OpenOCD code in development and a tarball has been made available for download <a href="../downloads/openocd-wnrf52.tgz">here</a>. Untar it. From the top of the directory tree ("openocd-code-89bf96ffe6ac66c80407af8383b9d5adc0dc35f4"), build it using the following configuration:</li>
</ul>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$./configure --enable-cmsis-dap --enable-openjtag_ftdi --enable-jlink --enable-stlink
</pre></div>


<p>Then run <code>make</code> and <code>sudo make install</code>. This step takes minutes, so be patient.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$ openocd -v
Open On-Chip Debugger 0.10.0-dev-snapshot (2016-05-20-10:43)
Licensed under GNU GPL v2
For bug reports, read
    http://openocd.org/doc/doxygen/bugs.html
</pre></div>


<p>Next, make sure that you have checked out the newt develop branch and rebuilt newt.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$ cd $GOPATH/src/mynewt.apache.org/newt
$ git checkout develop
$ git pull
$ cd newt
$ go install
</pre></div>


<p><strong>Note:</strong> This step can be removed once the changes have been pushed to master.</p>
<p>You can now use openocd to upload to Arduino Primo board via the USB port itself.</p>
<p><br></p>
<h3 id="install-jlinkexe">Install jlinkEXE</h3>
<p>In order to be able to communicate with the SEGGER J-Link debugger on the dev board, you have to download and install the J-Link GDB Server software on to your laptop. You may download the "Software and documentation pack for Mac OS X" from <a href="https://www.segger.com/jlink-software.html">https://www.segger.com/jlink-software.html</a>. </p>
<p><br></p>
<h3 id="create-a-project">Create a project.</h3>
<p>Create a new project to hold your work.  For a deeper understanding, you can read about project creation in 
<a href="../../get_started/project_create/">Get Started -- Creating Your First Project</a>
or just follow the commands below.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">    $ mkdir ~/dev
    $ cd ~/dev
    $ newt new myproj
    Downloading project skeleton from apache/incubator-mynewt-blinky...
    Installing skeleton in myproj...
    Project myproj successfully created.

    $ cd myproj

    $ newt install -v 
    apache-mynewt-core
    Downloading repository description for apache-mynewt-core... success!
    ...
    apache-mynewt-core successfully installed version 0.9.0
</pre></div>


<p><br></p>
<p>If you are working with 0.9.0 release (and not any subsequent releases), you will have to instruct newt to download code for the Arduino Primo Board Support Package (bsp) from the <code>develop</code> branch. You first edit the <code>project.yml</code> file in your project directory to change <code>vers:0-latest</code> to <code>0-dev</code>:</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">&lt;snip&gt;
#
repository.apache-mynewt-core:
    type: github
<span style="background-color: #ffffcc">    vers: 0-dev
</span>    user: apache
    repo: incubator-mynewt-core
</pre></div>


<p>Then you run <code>newt upgrade</code>:</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$ newt upgrade
apache-mynewt-core
Would you like to upgrade repository apache-mynewt-core from 0.9.0-none to 0.0.0-none ? [Yn] Y
</pre></div>


<p><strong>Note</strong>: With the next release, the Arduino Primo bsp will be included in the main release package. The above edit and <code>newt upgrade</code> step will not be required.</p>
<p><br></p>
<h3 id="create-the-targets">Create the targets</h3>
<p>Create two targets - one for the bootloader and one for the Primo board.  </p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$ newt target create primoblinky
$ newt target set primoblinky app=@apache-mynewt-core/apps/blinky bsp=@apache-mynewt-core/hw/bsp/arduino_primo_nrf52 build_profile=debug

$ newt target create primo_boot
$ newt target set primo_boot app=@apache-mynewt-core/apps/boot bsp=@apache-mynewt-core/hw/bsp/arduino_primo_nrf52 build_profile=optimized

$ newt target show
targets/my_blinky_sim
    app=apps/blinky
    bsp=@apache-mynewt-core/hw/bsp/native
    build_profile=debug
targets/primo_boot
    app=@apache-mynewt-core/apps/boot
    bsp=@apache-mynewt-core/hw/bsp/arduino_primo_nrf52
    build_profile=optimized
targets/primoblinky
    app=@apache-mynewt-core/apps/blinky
    bsp=@apache-mynewt-core/hw/bsp/arduino_primo_nrf52
    build_profile=optimized
</pre></div>


<p>If you are using openocd you must set the openocd_debug feature for both primo_boot and primoblinky.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$ newt target set primo_boot features=openocd_debug
$ newt target set primoblinky features=openocd_debug
</pre></div>


<p><br></p>
<h3 id="build-the-target-executables">Build the target executables</h3>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$ newt build primo_boot
&lt;snip&gt;
Compiling log_shell.c
Archiving log.a
Linking boot.elf
App successfully built: ~/dev/myproj/bin/primo_boot/apps/boot/boot.elf
</pre></div>


<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$ newt build primoblinky
&lt;snip&gt;
Compiling stats_shell.c
Archiving stats.a
Linking blinky.elf
App successfully built: ~/dev/myproj/bin/primoblinky/apps/blinky/blinky.elf
</pre></div>


<p><br></p>
<h3 id="sign-and-create-the-blinky-application-image">Sign and create the blinky application image</h3>
<p>You must sign and version your application image to download it using newt to the board. Use the newt create-image command to perform this action. You may assign an arbitrary version (e.g. 1.0.0) to the image.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$ newt create-image primoblinky 1.0.0
</pre></div>


<p><br></p>
<h3 id="connect-the-board">Connect the board</h3>
<p>Connect the Segger J-Link debug probe to the JTAG port on the Primo board using the Jlink 9-pin adapter and cable. Note that there are two JTAG ports on the board. Use the one nearest to the reset button as shown in the picture. Also use a micro USB 2.0 cable to connect the Primo board to one of your laptop's USB host ports.</p>
<p><img alt="J-Link debug probe to Arduino" src="../pics/primo-jlink.jpg" title="Connecting J-Link debug probe to Arduino Primo" /></p>
<p><br></p>
<p><strong>Note:</strong> If you are going the OpenOCD route, you do not need to attach this connector. </p>
<h3 id="download-to-the-target">Download to the target</h3>
<p>Download the bootloader first and then the blinky executable to the target platform. Don't forget to reset the board if you don't see the LED blinking right away. If the reset button doesn't work, powercycle the board!</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$ newt -v load primo_boot
$ newt -v load primoblinky
</pre></div>


<p><br></p>
<p><strong>Note:</strong> If you want to erase the flash and load the image again, you can use JLinkExe to issue an <code>erase</code> command.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">$ JLinkExe -device nRF52 -speed 4000 -if SWD
SEGGER J-Link Commander V5.12c (Compiled Apr 21 2016 16:05:51)
DLL version V5.12c, compiled Apr 21 2016 16:05:45

Connecting to J-Link via USB...O.K.
Firmware: J-Link OB-SAM3U128-V2-NordicSemi compiled Mar 15 2016 18:03:17
Hardware version: V1.00
S/N: 682863966
VTref = 3.300V


Type &quot;connect&quot; to establish a target connection, &#39;?&#39; for help
J-Link&gt;erase
Cortex-M4 identified.
Erasing device (0;?i?)...
Comparing flash   [100%] Done.
Erasing flash     [100%] Done.
Verifying flash   [100%] Done.
J-Link: Flash download: Total time needed: 0.363s (Prepare: 0.093s, Compare: 0.000s, Erase: 0.262s, Program: 0.000s, Verify: 0.000s, Restore: 0.008s)
Erasing done.
J-Link&gt;exit
$
</pre></div>


<p><br></p>
<h3 id="conclusion">Conclusion</h3>
<p>You have created, setup, compiled, loaded, and ran your first mynewt application
for an Arduino Primo board.</p>
<p>We have more fun tutorials for you to get your hands dirty. Be bold and work on the OS with tutorials on <a href="../unit_test/">writing a test suite</a> or try enabling additional functionality such as <a href="../project-target-slinky/">remote comms</a> or <a href="../bletiny_project/">Bluetooth Low Energy</a> on your current board.</p>
<p>If you see anything missing or want to send us feedback, please do so by signing up for appropriate mailing lists on our <a href="../../../community/">Community Page</a>.</p>
<p>Keep on hacking and blinking!</p>
                        
                        <div class="row">
                            



<ul class="nav nav-pills" style="margin-bottom: 10px">
    <li>
    
    <a href=../arduino_zero/>
        <span class="fa fa-arrow-left"></span>
        Previous: Blinky on Arduino Zero
    </a>
    
    </li>
    <li class="pull-right">
    
    <a href=../olimex/>
        Next: Blinky on Olimex
        <span class="fa fa-arrow-right"></span>
    </a>
    
    </li>
</ul>
                        </div>
                        <footer class="row">
    <div class="col-xs-12">
        
            <p class="copyright">Apache Mynewt (incubating) is available under Apache License, version 2.0.</p>
        
    </div>
    <div class="col-xs-12">
        <div class="logos">
            <img src="/img/asf_logo_wide_small.png" alt="Apache" title="Apache">
            <small class="footnote">
                MyNewt is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
            </small>
            <img src="/img/egg-logo2.png" alt="Apache Incubator" title="Apache Incubator">
        </div>
    </div>
</footer>
                    </div>
                </div>
            
            
        </div>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script src="../../../js/base.js"></script>
        <script src="../../../js/custom.js"></script>

    </body>
</html>
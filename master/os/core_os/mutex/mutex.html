

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    <title>Mutex &mdash; Apache Mynewt latest documentation</title>
    

    
    
      <link rel="shortcut icon" href="../../../_static/mynewt-logo-only-newt32x32.png"/>
    

    

    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

    
      <link rel="stylesheet" href="../../../_static/css/sphinx_theme.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/bootstrap-3.0.3.min.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/v2.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/restructuredtext.css" type="text/css" />
    

    

    <link rel="stylesheet" href="../../../_static/css/overrides.css" type="text/css" />
          <link rel="index" title="Index"
                href="../../../genindex.html"/>
          <link rel="search" title="Search" href="../../../search.html"/>
      <link rel="top" title="Apache Mynewt latest documentation" href="../../../index.html"/>
          <link rel="up" title="Apache Mynewt Operating System Kernel" href="../mynewt_os.html"/>
          <link rel="next" title="Semaphore" href="../semaphore/semaphore.html"/>
          <link rel="prev" title="Task" href="../task/task.html"/> 

    
    <script src="../../../_static/js/modernizr.min.js"></script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
	i["GoogleAnalyticsObject"] = r;
	(i[r] =
		i[r] ||
		function() {
			(i[r].q = i[r].q || []).push(arguments);
		}),
		(i[r].l = 1 * new Date());
	(a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
	a.async = 1;
	a.src = g;
	m.parentNode.insertBefore(a, m);
})(window, document, "script", "//www.google-analytics.com/analytics.js", "ga");

ga("create", "UA-72162311-1", "auto");
ga("send", "pageview");
</script>
    

  </head>

  <body class="not-front page-documentation" role="document" >
    <div id="wrapper">
      <div class="container">
    <div id="banner" class="row v2-main-banner">
        <a class="logo-cell" href="/">
            <img class="logo" src="../../../_static/img/logo.png">
        </a>
        <div class="tagline-cell">
            <h4 class="tagline">An OS to build, deploy and securely manage billions of devices</h4>
        </div>
        <div class="news-cell">
            <div class="well">
              <h4>Latest News:</h4> <a href="/download">Apache Mynewt 1.5.0 </a> released (Nov 5, 2018)
            </div>
        </div>
    </div>
</div>
      
<header>
    <nav id="navbar" class="navbar navbar-inverse" role="navigation">
        <div class="container">
            <!-- Collapsed navigation -->
            <div class="navbar-header">
                <!-- Expander button -->
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

            </div>

            <!-- Expanded navigation -->
            <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/"><i class="fa fa-home" style="font-size: larger;"></i></a>
                    </li>
                    <li class="important">
                        <a href="/quick-start/">Quick Start</a>
                    </li>
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    <li>
                        <a href="/talks/">Talks</a>
                    </li>
                    <li class="active">
                        <a href="/documentation/">Documentation</a>
                    </li>
                    <li>
                        <a href="/download/">Download</a>
                    </li>
                    <li>
                        <a href="/community/">Community</a>
                    </li>
                    <li>
                        <a href="/events/">Events</a>
                    </li>
                </ul>

                <!-- Search, Navigation and Repo links -->
                <ul class="nav navbar-nav navbar-right">
                    
                </ul>
            </div>
        </div>
    </nav>
</header>
      <!-- STARTS MAIN CONTENT -->
      <div id="main-content">
        





<div id="breadcrumb">
  <div class="container">
    <a href="/documentation/">Docs</a> /
    
      <a href="../../os_user_guide.html">OS User Guide</a> /
    
      <a href="../mynewt_os.html">Apache Mynewt Operating System Kernel</a> /
    
    Mutex
    
  <div class="sourcelink">
    <a href="https://github.com/apache/mynewt-core/edit/master/docs/os/core_os/mutex/mutex.rst" class="icon icon-github"
           rel="nofollow"> Edit on GitHub</a>
</div>
  </div>
</div>
        <!-- STARTS CONTAINER -->
        <div class="container">
          <!-- STARTS .content -->
          <div id="content" class="row">
            
            <!-- STARTS .container-sidebar -->
<div class="container-sidebar col-xs-12 col-sm-3">
  <div id="docSidebar" class="sticky-container">
    <div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    <!-- Note: only works when deployed -->
<select class="form-control" onchange="if (this.value) window.location.href=this.value">
  <option value="/latest" selected>
    Version: latest
  </option>
  <option value="/v1_4_0">
    Version: 1.4.0
  </option>
  <option value="/v1_3_0/os/introduction">
    Version: 1.3.0
  </option>
  <option value="/v1_2_0/os/introduction">
    Version: 1.2.0
  </option>
  <option value="/v1_1_0/os/introduction">
    Version: 1.1.0
  </option>
  <option value="/v1_0_0/os/introduction">
    Version: 1.0.0
  </option>
  <option value="/v0_9_0/os/introduction">
    Version: 0_9_0
  </option>
</select>
    <div class="region region-sidebar">
      <div class="docs-menu">
      
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/index.html">Setup &amp; Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../os_user_guide.html">OS User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../mynewt_os.html">Kernel</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../context_switch/context_switch.html">Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task/task.html">Task</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Mutex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../semaphore/semaphore.html">Semaphore</a></li>
<li class="toctree-l3"><a class="reference internal" href="../event_queue/event_queue.html">Event Queues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../callout/callout.html">Callout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../heap/heap.html">Heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../memory_pool/memory_pool.html">Memory Pools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mbuf/mbuf.html">Mbufs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cputime/os_cputime.html">CPU Time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../time/os_time.html">OS Time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sanity/sanity.html">Sanity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/system_modules.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/hal/hal.html">Hardware Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/bootloader/bootloader.html">Secure Bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/split/split.html">Split Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../porting/port_os.html">Porting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/baselibc.html">Baselibc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/drivers/driver.html">Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/devmgmt/newtmgr.html">Device Management with Newt Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/imgmgr/imgmgr.html">Image Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/sysinitconfig/sysinitconfig.html">Compile-Time Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/fs/fs.html">File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/fcb/fcb.html">Flash Circular Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/sensor_framework/sensor_framework.html">Sensor Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/testutil/testutil.html">Test Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/json/json.html">JSON</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../network/docs/index.html">BLE User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../newt/index.html">Newt Tool Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../newtmgr/index.html">Newt Manager Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mynewt_faq/index.html">Mynewt FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/index.html">Appendix</a></li>
</ul>

        
      
      </div>
    </div>
  </div>
  <!-- ENDS STICKY CONTAINER -->
</div>
<!-- ENDS .container-sidebar -->

            <div class="col-xs-12 col-sm-9">
              
              <div class="">
                <div class="rst-content">
                  <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                   <div itemprop="articleBody">
                    
  <div class="section" id="mutex">
<h1>Mutex<a class="headerlink" href="#mutex" title="Permalink to this headline">¶</a></h1>
<p>Mutex is short for “mutual exclusion”; a mutex provides mutually
exclusive access to a shared resource. A mutex provides <em>priority
inheritance</em> in order to prevent <em>priority inversion</em>. Priority
inversion occurs when a higher priority task is waiting on a resource
owned by a lower priority task. Using a mutex, the lower priority task
will inherit the highest priority of any task waiting on the mutex.</p>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The first order of business when using a mutex is to declare the mutex
globally. The mutex needs to be initialized before it is used (see the
examples). It is generally a good idea to initialize the mutex before
tasks start running in order to avoid a task possibly using the mutex
before it is initialized.</p>
<p>When a task wants exclusive access to a shared resource it needs to
obtain the mutex by calling <a class="reference internal" href="#c.os_mutex_pend" title="os_mutex_pend"><code class="xref c c-func docutils literal notranslate"><span class="pre">os_mutex_pend()</span></code></a>. If the mutex is currently
owned by a different task (a lower priority task), the requesting task
will be put to sleep and the owners priority will be elevated to the
priority of the requesting task. Note that multiple tasks can request
ownership and the current owner is elevated to the highest priority of
any task waitin on the mutex. When the task is done using the shared
resource, it needs to release the mutex by called <a class="reference internal" href="#c.os_mutex_release" title="os_mutex_release"><code class="xref c c-func docutils literal notranslate"><span class="pre">os_mutex_release()</span></code></a>.
There needs to be one release per call to pend. Note that nested calls
to <a class="reference internal" href="#c.os_mutex_pend" title="os_mutex_pend"><code class="xref c c-func docutils literal notranslate"><span class="pre">os_mutex_pend()</span></code></a> are allowed but there needs to be one release per
pend.</p>
<p>The following example will illustrate how priority inheritance works. In
this example, the task number is the same as its priority. Remember that
the lower the number, the higher the priority (i.e. priority 0 is higher
priority than priority 1). Suppose that task 5 gets ownership of a mutex
but is preempted by task 4. Task 4 attempts to gain ownership of the
mutex but cannot as it is owned by task 5. Task 4 is put to sleep and
task 5 is temporarily raised to priority 4. Before task 5 can release
the mutex, task 3 runs and attempts to acquire the mutex. At this point,
both task 3 and task 4 are waiting on the mutex (sleeping). Task 5 now
runs at priority 3 (the highest priority of all the tasks waiting on the
mutex). When task 5 finally releases the mutex it will be preempted as
two higher priority tasks are waiting for it.</p>
<p>Note that when multiple tasks are waiting on a mutex owned by another
task, once the mutex is released the highest priority task waiting on
the mutex is run.</p>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<dl class="variable">
<dt id="c.os_mutex::_pad">
<span class="target" id="group___o_s_mutex_1ga57ebc843a2abfdfb150484709f8c918b"></span>uint8_t <code class="descclassname">os_mutex::</code><code class="descname">_pad</code><a class="headerlink" href="#c.os_mutex::_pad" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.os_mutex::mu_prio">
<span class="target" id="group___o_s_mutex_1gab11db74bc914d330188ec8cf6b7ccda1"></span>uint8_t <code class="descclassname">os_mutex::</code><code class="descname">mu_prio</code><a class="headerlink" href="#c.os_mutex::mu_prio" title="Permalink to this definition">¶</a></dt>
<dd><p>Mutex owner’s default priority. </p>
</dd></dl>

<dl class="variable">
<dt id="c.os_mutex::mu_level">
<span class="target" id="group___o_s_mutex_1ga3f5cb3a993b3d3ceae9c9a3050cf7e0e"></span>uint16_t <code class="descclassname">os_mutex::</code><code class="descname">mu_level</code><a class="headerlink" href="#c.os_mutex::mu_level" title="Permalink to this definition">¶</a></dt>
<dd><p>Mutex call nesting level. </p>
</dd></dl>

<dl class="variable">
<dt id="c.os_mutex::mu_owner">
<span class="target" id="group___o_s_mutex_1gad7f904991f57f1289b0947da3b3ee339"></span>struct os_task* <code class="descclassname">os_mutex::</code><code class="descname">mu_owner</code><a class="headerlink" href="#c.os_mutex::mu_owner" title="Permalink to this definition">¶</a></dt>
<dd><p>Task that owns the mutex. </p>
</dd></dl>

<dl class="function">
<dt id="c.os_mutex::SLIST_HEAD">
<span class="target" id="group___o_s_mutex_1ga639310579608b2315fdace1a33a51ea7"></span><code class="descclassname">os_mutex::</code><code class="descname">SLIST_HEAD</code><span class="sig-paren">(</span>os_task<span class="sig-paren">)</span><a class="headerlink" href="#c.os_mutex::SLIST_HEAD" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="c.os_mutex_init">
<span class="target" id="group___o_s_mutex_1gad40a5e8c7af09d2cbe4bbc1ef88d48dd"></span>os_error_t <code class="descname">os_mutex_init</code><span class="sig-paren">(</span>struct  os_mutex  *<em>&nbsp;mu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.os_mutex_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a mutex and initialize it. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>os_error_t OS_INVALID_PARM Mutex passed in was NULL. OS_OK no error. </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">mu</span></code>: Pointer to mutex</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="c.os_mutex_release">
<span class="target" id="group___o_s_mutex_1ga73b1ca40d62d2e08f6f7bce52e50db30"></span>os_error_t <code class="descname">os_mutex_release</code><span class="sig-paren">(</span>struct  os_mutex  *<em>&nbsp;mu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.os_mutex_release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release a mutex. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>os_error_t OS_INVALID_PARM Mutex passed in was NULL. OS_BAD_MUTEX Mutex was not granted to current task (not owner). OS_OK No error </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">mu</span></code>: Pointer to the mutex to be released</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="c.os_mutex_pend">
<span class="target" id="group___o_s_mutex_1ga20170f05ba8c744a1536a4bed50ae4ca"></span>os_error_t <code class="descname">os_mutex_pend</code><span class="sig-paren">(</span>struct  os_mutex  *<em>&nbsp;mu</em>, <a class="reference internal" href="../time/os_time.html#c.os_time_t" title="os_time_t">os_time_t</a><em>&nbsp;timeout</em><span class="sig-paren">)</span><a class="headerlink" href="#c.os_mutex_pend" title="Permalink to this definition">¶</a></dt>
<dd><p>Pend (wait) for a mutex. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>os_error_t OS_INVALID_PARM Mutex passed in was NULL. OS_TIMEOUT Mutex was owned by another task and timeout=0 OS_OK no error. </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">mu</span></code>: Pointer to mutex. </li>
<li><code class="docutils literal notranslate"><span class="pre">timeout</span></code>: Timeout, in os ticks. A timeout of 0 means do not wait if not available. A timeout of OS_TIMEOUT_NEVER means wait forever.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="class">
<dt id="_CPPv38os_mutex">
<span id="_CPPv28os_mutex"></span><span id="os_mutex"></span><span class="target" id="structos__mutex"></span><em class="property">struct </em><code class="descname">os_mutex</code><a class="headerlink" href="#_CPPv38os_mutex" title="Permalink to this definition">¶</a><br /></dt>
<dd><em>#include &lt;os_mutex.h&gt;</em><p>OS mutex structure. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt>
<span class="target" id="group___o_s_mutex_1gab11db74bc914d330188ec8cf6b7ccda1"></span>uint8_t <code class="descname">mu_prio</code></dt>
<dd><p>Mutex owner’s default priority. </p>
</dd></dl>

<dl class="variable">
<dt>
<span class="target" id="group___o_s_mutex_1ga3f5cb3a993b3d3ceae9c9a3050cf7e0e"></span>uint16_t <code class="descname">mu_level</code></dt>
<dd><p>Mutex call nesting level. </p>
</dd></dl>

<dl class="variable">
<dt>
<span class="target" id="group___o_s_mutex_1gad7f904991f57f1289b0947da3b3ee339"></span>struct os_task* <code class="descname">mu_owner</code></dt>
<dd><p>Task that owns the mutex. </p>
</dd></dl>

</div>
</dd></dl>

</div>
</div>


                   </div>
                  </div>
                  
    <div class="rst-footer-buttons row" role="navigation" aria-label="footer navigation">
      
        <a href="../semaphore/semaphore.html" class="btn btn-neutral float-right" title="Semaphore" accesskey="n">Next: Semaphore <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../task/task.html" class="btn btn-neutral" title="Task" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous: Task</a>
      
    </div>

                </div>
              </div>
            </div>
            <!-- ENDS CONTENT SECTION -->
          </div>
          <!-- ENDS .content -->
        </div>
      </div>
      <footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
          
              <p class="copyright">Apache Mynewt is available under Apache License, version 2.0.</p>
          
      </div>
      <div class="col-xs-12">
          <div class="logos">
              <img src="../../../_static/img/asf_logo_wide_small.png" alt="Apache" title="Apache">
              <small class="footnote">
                Apache Mynewt, Mynewt, Apache, the Apache feather logo, and the Apache Mynewt project logo are either
                registered trademarks or trademarks of the Apache Software Foundation in the United States and other countries.
              </small>
              <a href="https://join.slack.com/mynewt/shared_invite/MTkwMTg1ODM1NTg5LTE0OTYxNzQ4NzQtZTU1YmNhYjhkMg">
                <img src="../../../_static/img/add_to_slack.png" alt="Slack Icon" title="Join our Slack Community" />
              </a>
          </div>
      </div>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #wrapper -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'latest',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/js/bootstrap-3.0.3.min.js"></script>
      <script type="text/javascript" src="../../../_static/js/affix.js"></script>
      <script type="text/javascript" src="../../../_static/js/main.js"></script>

   

  </body>
</html>